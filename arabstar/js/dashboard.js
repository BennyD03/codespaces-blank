(()=>{let e=document.querySelector(".users"),t=[],n=document.querySelector(".num-of-users"),r=20,a="",s=0;function i(){let i=document.createDocumentFragment("frag"),p=t;""!=a&&(p=p.filter((e=>(e.firstname??"").toLowerCase().indexOf(a.toLowerCase())>=0||(e.lastname??"").toLowerCase().indexOf(a.toLowerCase())>=0||(e.email??"").toLowerCase().indexOf(a.toLowerCase())>=0))),n.innerHTML=p.length,s=p.length,p.slice(0,r).forEach((e=>{let t=document.createElement("div");t.innerHTML=`\n      <div\n          class="user border border-2 rounded-3 p-1 d-flex align-items-center shadow mb-4"\n          id="user-${e.id}"\n        >\n          <div class="profile-img me-2 ms-2">\n            <svg\n              xmlns="http://www.w3.org/2000/svg"\n              width="40"\n              height="40"\n              fill="currentColor"\n              class="bi bi-person-fill"\n              viewBox="0 0 16 16"\n            >\n              <path\n                d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3Zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"\n              />\n            </svg>\n          </div>\n          <div class="profile-detail flex-grow-1 p-2 me-5">\n            <p>${e.lastname+" "+e.firstname}</p>\n            <p class="email fw-bold">\n              ${e.email}\n            </p>\n            <p>Investment: $<span class="user-investment-${e.id}" >${e.investment}</span></p>\n            <p>Earning: $<span class="user-earning-${e.id}" >${e.earning}</span></p>\n          </div>\n          <div style="height:120px; flex-direction:column; justify-content:space-between;" class="profile-edit  d-flex">\n           <button id="${e.id}" class="btn btn-lg btn-danger d-flex p-1 me-2 delete-user-btn">\n              <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">\n  <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>\n  <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>\n</svg>\n            </button>\n            <button id="${e.id}" class="btn btn-lg btn-primary d-flex p-1 me-2 edit-user-btn">\n              <svg\n                xmlns="http://www.w3.org/2000/svg"\n                width="22"\n                height="22"\n                fill="currentColor"\n                class="bi bi-pencil-square"\n                viewBox="0 0 16 16"\n              >\n                <path\n                  d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"\n                />\n                <path\n                  fill-rule="evenodd"\n                  d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"\n                />\n              </svg>\n            </button>\n           \n          </div>\n        </div>\n`,i.append(t)})),e.innerHTML="",e.append(i),s<=r?b.classList.add("more-hide"):b.classList.remove("more-hide"),document.querySelectorAll(".edit-user-btn").forEach((e=>{e.addEventListener("click",(e=>{l=e.currentTarget.id,o=t.filter((e=>e.id==l)),o=o[0],d.innerHTML=o.lastname+" "+o.firstname,u.innerHTML=o.email,c.innerHTML=o.investment,m.innerHTML=o.earning,v.click()}))})),document.querySelectorAll(".delete-user-btn").forEach((e=>{e.addEventListener("click",(e=>{if(l=e.currentTarget.id,o=t.filter((e=>e.id==l)),o=o[0],confirm(`Are you sure you want to delete ${o.email} account?`)){let e=new FormData;e.append("delete_user",l),fetch(ADMINURL+"/scripts/server.php",{method:"POST",body:e}).then((e=>e.text())).then((e=>{e.indexOf("user deleted")>=0?(document.querySelector("#user-"+l).remove(),alert("user account has been deleted")):alert("something went wrong,could not delete user")}))}}))}))}!async function(){let e=new FormData;e.append("get_users","");let n=await fetch(ADMINURL+"/scripts/server.php",{method:"POST",body:e});t=await n.json(),t.sort(((e,t)=>new Date(t.date)-new Date(e.date))),i()}();let l,o,d=document.querySelector(".profile-edit-name"),u=document.querySelector(".profile-edit-email"),c=document.querySelector(".profile-investment"),m=document.querySelector(".profile-earning"),v=document.querySelector(".open-edit-prrofile-btn");var p=document.querySelector(".user-search-form"),h=document.querySelector(".user-search-input");h.addEventListener("input",(()=>{""==h.value&&(a=h.value,i())})),p.addEventListener("submit",(e=>{e.preventDefault(),a=h.value,i()}));let b=document.querySelector(".more-btn");b.addEventListener("click",(()=>{s>r&&(r+=10),i()}));let f=document.querySelector(".change-password-form"),g=document.querySelector(".old-password-input"),y=document.querySelector(".new-password-input"),L=document.querySelector(".password-alert-box"),w=document.querySelector(".change-alert-message");f.addEventListener("submit",(e=>{e.preventDefault();let t=new FormData(f);t.append("change_password",""),w.innerHTML='<div class="alert alert-secondary mt-3" role="alert"> Please wait...</div>',fetch(ADMINURL+"/scripts/server.php",{method:"POST",body:t}).then((e=>e.text())).then((e=>{w.innerHTML="",e.indexOf("password changed successfully")>=0?(g.value="",y.value="",L.innerHTML='<div class="alert alert-success alert-dismissible" role="alert">Password changed successfully<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>'):""!=e&&(L.innerHTML='<div class="alert alert-danger alert-dismissible" role="alert">'+e+'<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>')}))}));let M=document.querySelector(".investment-value"),S=document.querySelector(".add-investment-btn"),q=document.querySelector(".add-investment-spinner"),x=document.querySelector(".remove-investment-btn"),T=document.querySelector(".remove-investment-spinner"),H=document.querySelector(".earning-value"),D=document.querySelector(".add-earning-btn"),E=document.querySelector(".add-earning-spinner"),F=document.querySelector(".remove-earning-btn"),O=document.querySelector(".remove-earning-spinner"),$=!1,C=document.querySelector(".edit-alert-box");S.addEventListener("click",(()=>{if($)return;if(""==M.value)return void alert("Enter investment amount");if(!confirm("Do you want to add $"+M.value+" investment to user account?"))return;q.classList.remove("hide"),$=!0;let e=new FormData;e.append("add_investment",M.value),e.append("user_id",l),fetch(ADMINURL+"/scripts/server.php",{method:"POST",body:e}).then((e=>e.text())).then((e=>{$=!1,q.classList.add("hide"),e.indexOf("investment added")>=0?(o.investment=parseFloat(o.investment)+Math.abs(M.value),o.investment=o.investment.toFixed(2),c.innerHTML=o.investment,document.querySelector(".user-investment-"+l).innerHTML=o.investment,M.value="",C.innerHTML='<div class="alert alert-success alert-dismissible" role="alert">Investement added successfully <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>'):""!=e&&alert(e)}))})),x.addEventListener("click",(()=>{if($)return;if(""==M.value)return void alert("Enter investment amount");if(parseInt(o.investment)-M.value<0)return void alert("value is greater than balance");if(!confirm("Do you want to remove $"+M.value+" investment from user account?"))return;T.classList.remove("hide"),$=!0;let e=new FormData;e.append("remove_investment",M.value),e.append("user_id",l),fetch(ADMINURL+"/scripts/server.php",{method:"POST",body:e}).then((e=>e.text())).then((e=>{$=!1,T.classList.add("hide"),e.indexOf("investment removed")>=0?(o.investment=parseFloat(o.investment)-Math.abs(M.value),o.investment=o.investment.toFixed(2),c.innerHTML=o.investment,document.querySelector(".user-investment-"+l).innerHTML=o.investment,M.value="",C.innerHTML='<div class="alert alert-success alert-dismissible" role="alert">Investement removed successfully <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>'):""!=e&&alert(e)}))})),D.addEventListener("click",(()=>{if($)return;if(""==H.value)return void alert("Enter earning amount");if(!confirm("Do you want to add $"+H.value+" earning to user account?"))return;E.classList.remove("hide"),$=!0;let e=new FormData;e.append("add_earning",H.value),e.append("user_id",l),fetch(ADMINURL+"/scripts/server.php",{method:"POST",body:e}).then((e=>e.text())).then((e=>{$=!1,E.classList.add("hide"),e.indexOf("earning added")>=0?(o.earning=parseFloat(o.earning)+Math.abs(H.value),o.earning=o.earning.toFixed(2),m.innerHTML=o.earning,document.querySelector(".user-earning-"+l).innerHTML=o.earning,H.value="",C.innerHTML='<div class="alert alert-success alert-dismissible" role="alert">Earning added successfully <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>'):""!=e&&alert(e)}))})),F.addEventListener("click",(()=>{if($)return;if(""==H.value)return void alert("Enter earning amount");if(parseInt(o.earning)-H.value<0)return void alert("value is greater than balance");if(!confirm("Do you want to remove $"+H.value+" earning from user account?"))return;O.classList.remove("hide"),$=!0;let e=new FormData;e.append("remove_earning",H.value),e.append("user_id",l),fetch(ADMINURL+"/scripts/server.php",{method:"POST",body:e}).then((e=>e.text())).then((e=>{$=!1,O.classList.add("hide"),e.indexOf("earning removed")>=0?(o.earning=parseFloat(o.earning)-Math.abs(H.value),o.earning=o.earning.toFixed(2),m.innerHTML=o.earning,document.querySelector(".user-earning-"+l).innerHTML=o.earning,H.value="",C.innerHTML='<div class="alert alert-success alert-dismissible" role="alert">Earning removed successfully <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>'):""!=e&&alert(e)}))}))})();